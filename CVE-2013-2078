Description: x86/xsave: properly check guest input to XSETBV
 Other than the HVM emulation path, the PV case so far failed to check
 that YMM state requires SSE state to be enabled, allowing for a #GP to
 occur upon passing the inputs to XSETBV inside the hypervisor.
From: Jan Beulich <jbeulich@suse.com>
Id: CVE-2013-2078 XSA-54.
---
--- a/xen/arch/x86/traps.c
+++ b/xen/arch/x86/traps.c
@@ -2286,6 +2286,11 @@ static int emulate_privileged_op(struct cpu_user_regs *regs)
                     if ( !(new_xfeature & XSTATE_FP) || (new_xfeature & ~xfeature_mask) )
                         goto fail;
 
+                    /* YMM state takes SSE state as prerequisite. */
+                    if ( (xfeature_mask & new_xfeature & XSTATE_YMM) &&
+                         !(new_xfeature & XSTATE_SSE) )
+                        goto fail;
+
                     v->arch.xcr0 = new_xfeature;
                     v->arch.xcr0_accum |= new_xfeature;
                     set_xcr0(new_xfeature);
